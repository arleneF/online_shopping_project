extends layout

block content
  h2= title

  br
  p #[strong Price:] CDN$ #{item.price}
  p #[strong Category:] #{item.category.name}
  p #[strong Sold by:] #{item.seller.local.fname} #{item.seller.local.lname}
  if item.description
    p #[strong Description:] #{item.description}

  if (user == 'seller')
    a.btn.btn-secondary(href='/items/'+item._id+'/update' role='button') Update

    form(method='POST' action=item.url+'/delete')
        div.form-group
          input#itemid.form-control(type='hidden',name='itemid', required='true', value=item._id )
        button.btn.btn-danger(type='submit') Delete
  else
    form(method='GET' action=item.url+'/buy')
        div.form-group
          input#itemid.form-control(type='hidden',name='itemid', required='true', value=item._id )
        button.btn.btn-danger(type='submit') Buy
    br
    form(method='POST' action=item.url+'/review' id='review_form')
        div.form-group
            label(for='review') #[strong Rate]
            .rateyo(data-rateyo-rating='0%', data-rateyo-spacing='10px', data-rateyo-rated-fill='#ffdb03')
        div.form-group
          label(for='review') #[strong Review:]
          textarea#review.form-control(name='review')
        div.form-group
            input#itemid.form-control(type='hidden',name='itemid', required='true', value=item._id )
        div.form-group
            input#rate_field.form-control(type='hidden',name='rate_field', required='true', value='0')
        button.btn.btn-danger(type='submit') Write A reviews

    br
    label(for='previous_reviews') #[strong Previous Reviews:]
    -function prettyDate(dateString){
        //if it's already a date object and not a string you don't need this line:
        -var date = new Date(dateString);
        -var d = date.getDate();
        -var monthNames = [ "Jan", "Feb", "Mar", "Apr", "May", "Jun","Jul", "Aug", "Sep", "Oct", "Nov", "Dec" ];
        -var m = monthNames[date.getMonth()];
        -var y = date.getFullYear();
        -return d+' '+m+' '+y;
    -}
    div
      table
          each review in review_list
            tr
              td #{review.review}
              td #{review.reviewer.local.fname}
              td #{prettyDate(review.review_date)}
          else
            li No review

    if (error)
        p(class="error") #{error}

    if (message)
        p(class="message") #{message}

    script(type='text/javascript', src='/scripts/rating_logic.js')
    script(type='text/javascript', src='/scripts/rating.js')

